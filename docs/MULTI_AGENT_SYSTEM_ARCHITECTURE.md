# Multi-Agent Task Orchestration System
## Architecture Documentation

## Overview
This system provides a unified entry point for orchestrating complex tasks across three specialized AI agents: **Emil**, **Lola**, and **Nova**. Each agent has distinct capabilities and responsibilities, and the system intelligently routes tasks to the appropriate agent based on the requirements.

---

## System Architecture

### Main Entry Point: `main.py`

The main orchestrator that:
1. Takes a high-level user prompt
2. Calls `generate_level_0_task_list()` to break down the request into discrete tasks
3. Routes each task to the appropriate agent (Emil, Lola, or Nova)
4. Executes tasks in sequence, respecting dependencies
5. Handles errors with retry logic and user interaction
6. Tracks progress and provides detailed logging

**Key Parameters:**
- `test_mode`: Boolean flag for testing (default: False)
- `test_dag`: Optional test DAG path for testing mode
- `max_attempts`: Maximum retry attempts per task (default: 3)
- `ai_mode`: Operation mode ('auto-pilot', 'manual', etc.)

---

## Agent Capabilities

### ğŸ”§ Emil - Director of Engineering
**Module:** `src/EMIL/Emil.py`

**Responsibilities:**
- Data file operations (CSV, Excel, JSON, databases)
- PLEXOS model interactions and modifications
- Energy system modeling (supply/demand, infrastructure)
- Climate modeling and hydraulic modeling
- Network modeling and simulations
- Technical analysis and computations
- Model distillation and geographic subsetting

**Special Features:**
- âœ… PLEXOS model loading (`load_model_decision`)
- âœ… Database copy operations (`copy_db`)
- âœ… AI-powered failure analysis
- âœ… Complex technical DAG generation

---

### ğŸ“ Lola - Communications Director
**Module:** `src/LOLA/Lola.py`

**Responsibilities:**
- Website copy and content creation
- Social media management and posts
- Long-form report writing
- Communications strategy
- Technical report coordination (coordinates with Emil for data)
- Marketing and public relations content

**Special Features:**
- âŒ NO PLEXOS model loading (content-focused)
- âœ… May need to coordinate with Emil for technical data
- âœ… Progress tracking for content generation tasks
- âœ… Separate progress file namespace (`lola_progress_*`)

---

### ğŸ¤– Nova - Virtual Assistant
**Module:** `src/NOVA/Nova.py`

**Responsibilities:**
- Calendar management and scheduling
- Email management and communications
- Reading and summarizing files and log files
- Providing status updates and general information
- Administrative tasks and personal assistant duties
- Information retrieval and lookups

**Special Features:**
- âŒ NO PLEXOS model loading (administrative tasks only)
- âŒ NO technical modeling operations
- âœ… File reading and summarization
- âœ… Separate progress file namespace (`nova_progress_*`)

---

## Task Structure

### Level 0 Task List Format
Generated by `generate_level_0_task_list()`:

```json
{
  "coordinator_reasoning": "Explanation of task breakdown",
  "tasks": [
    {
      "task_id": "unique_task_identifier",
      "task_description": "High-level description",
      "assistant": "Emil|Lola|Nova",
      "dependencies": ["task_id_1", "task_id_2"],
      "priority": "high|medium|low",
      "estimated_complexity": "simple|moderate|complex",
      "expected_outputs": ["output_type_1", "output_type_2"],
      "input_requirements": ["requirement_1", "requirement_2"],
      "scope": "Detailed scope and boundaries",
      "notes": "Additional context"
    }
  ],
  "workflow_name": "descriptive_workflow_name"
}
```

---

## Execution Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Prompt                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  generate_level_0_task_list()       â”‚
â”‚  - Analyzes prompt                  â”‚
â”‚  - Breaks into tasks                â”‚
â”‚  - Assigns to agents                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Task Iteration Loop                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼              â–¼          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
   â”‚ EMIL  â”‚     â”‚ LOLA  â”‚  â”‚ NOVA  â”‚
   â””â”€â”€â”€â”¬â”€â”€â”€â”˜     â””â”€â”€â”€â”¬â”€â”€â”€â”˜  â””â”€â”€â”€â”¬â”€â”€â”€â”˜
       â”‚             â”‚          â”‚
       â–¼             â–¼          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Generate/Select DAG          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Execute Pipeline(s)          â”‚
   â”‚ - Retry on failure           â”‚
   â”‚ - Save progress              â”‚
   â”‚ - Log results                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Return Final Outputs         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Common Interface

All three agents share the same `main()` function signature:

```python
def main(
    user_prompt: str,
    test_mode: bool = False,
    test_dag: Optional[str] = None,
    resume_from_progress: Optional[str] = None,
    max_attempts: int = 3,
    ai_mode: str = "auto-pilot"
) -> Dict[str, Any]:
    """
    Execute tasks for the agent.
    
    Returns:
        Dict containing final outputs from all completed pipelines
    """
```

---

## Progress Management

### Progress Files
Each agent maintains separate progress files:
- **Emil**: `pipeline_progress/progress_*`
- **Lola**: `pipeline_progress/lola_progress_*`
- **Nova**: `pipeline_progress/nova_progress_*`

### Progress Features
- âœ… Auto-save after each attempt (success or failure)
- âœ… Resume capability from saved state
- âœ… Automatic cleanup (7-day retention)
- âœ… Detailed attempt history with timestamps
- âœ… Failure analysis (Emil only)

---

## Error Handling

### Retry Logic
- Each pipeline can be retried up to `max_attempts` times
- Progress is saved after every attempt
- Detailed exception tracking and logging

### User Interaction
- On failure after max attempts, user is prompted:
  ```
  Continue to next task? (y/n):
  ```
- User can choose to continue or stop execution

### Failure Analysis (Emil Only)
- AI-powered root cause analysis
- Suggestions for resolution
- Success probability estimation

---

## Example Usage

### Simple Task
```python
# main.py
user_prompt = "Build the tst workbooks for hydrogen demand."

# System breaks this into:
# - Task 1: Emil creates data structure
# - Task 2: Emil populates with demand data
# - Task 3: Lola creates summary report
```

### Complex Multi-Agent Task
```python
user_prompt = """
Distill the Joule model to Irish scope, add a nuclear power plant,
run basecase and nuclear scenarios, then write a comparative report.
"""

# System breaks this into:
# - Task 1: Emil distills model to Ireland
# - Task 2: Emil adds nuclear infrastructure
# - Task 3: Emil runs both scenarios
# - Task 4: Lola writes comparison report (depends on Task 3)
```

---

## Configuration Files

### Required Files
- `config/default_ai_models.yaml` - AI model configuration
- `config/function_registry.json` - Available functions
- `task_lists/index.json` - DAG registry
- `pipeline/pipelines/index.json` - Pipeline definitions

### File Locations
```
project_root/
â”œâ”€â”€ main.py                          # Main orchestrator
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ default_ai_models.yaml
â”‚   â”œâ”€â”€ function_registry.json
â”‚   â””â”€â”€ ...
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ EMIL/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ Emil.py
â”‚   â”œâ”€â”€ LOLA/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ Lola.py
â”‚   â”œâ”€â”€ NOVA/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ Nova.py
â”‚   â””â”€â”€ ai/
â”‚       â””â”€â”€ architecture/
â”‚           â””â”€â”€ choose_or_create_dag.py
â””â”€â”€ pipeline_progress/               # Auto-generated progress files
```

---

## Key Differences Between Agents

| Feature | Emil | Lola | Nova |
|---------|------|------|------|
| PLEXOS Model Access | âœ… Yes | âŒ No | âŒ No |
| Database Operations | âœ… Yes | âŒ No | âŒ No |
| Technical Modeling | âœ… Yes | âŒ No | âŒ No |
| Content Generation | âš ï¸ Reports | âœ… Primary | âš ï¸ Summaries |
| File Operations | âœ… All types | âš ï¸ Limited | âœ… Read/Info |
| AI Failure Analysis | âœ… Yes | âŒ No | âŒ No |
| Progress File Prefix | `progress_` | `lola_progress_` | `nova_progress_` |

---

## Best Practices

### Task Design
- Keep tasks **HIGH-LEVEL** - agents create their own detailed sub-DAGs
- Clearly define **dependencies** between tasks
- Provide rich **context** and **scope** for each task
- Specify **expected outputs** and **input requirements**

### Agent Selection
- **Emil**: Any technical, modeling, or data manipulation task
- **Lola**: Communication, content, reports, documentation
- **Nova**: Administrative, information retrieval, file summaries

### Dependencies
- If Lola needs technical data, create Emil task first
- Set Lola's task to depend on Emil's task ID
- System executes in dependency order automatically

---

## Logging

All agents use consistent logging:
```python
logger.info("="*80)
logger.info("AGENT_NAME - Status Message")
logger.info("="*80)
```

Log levels:
- `INFO`: Task progress, completions
- `WARNING`: Retries, skipped tasks
- `ERROR`: Failures after all retries
- `DEBUG`: Detailed execution info

---

## Future Enhancements

### Potential Additions
- [ ] Parallel task execution (for independent tasks)
- [ ] Task priority scheduling
- [ ] Real-time progress dashboard
- [ ] Agent communication protocol (Emil â†’ Lola data transfer)
- [ ] Task result caching
- [ ] Enhanced error recovery strategies

---

## Troubleshooting

### Common Issues

**Import Errors**
```
ModuleNotFoundError: No module named 'src.EMIL'
```
**Solution:** Ensure `__init__.py` files exist in all agent directories

**Task Not Executing**
```
WARNING: Unknown assistant 'emil' for task...
```
**Solution:** Check `assistant` field in task list is exactly "Emil", "Lola", or "Nova" (case-insensitive)

**Progress Not Resuming**
```
Failed to load progress, starting fresh
```
**Solution:** Verify progress file path exists and is valid JSON

---

## Support

For questions or issues:
1. Check logs in `logs/` directory
2. Review progress files in `pipeline_progress/`
3. Verify task list generation with test prompts
4. Check agent-specific logs (Emil, Lola, Nova)

---

**Version:** 1.0  
**Last Updated:** October 2, 2025  
**Authors:** AI Architecture Team
